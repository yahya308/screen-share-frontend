<!DOCTYPE html>
<html lang="tr" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VELOSTREAM - Room</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        brand: { 500: '#0ea5e9', 600: '#0284c7', 700: '#0369a1' }
                    }
                }
            }
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.min.js"></script>
    <script type="importmap">
        {
            "imports": {
                "mediasoup-client": "https://esm.sh/mediasoup-client@3.18.1"
            }
        }
    </script>
</head>

<body class="bg-slate-900 text-slate-100 min-h-screen">

    <!-- Header -->
    <header class="bg-slate-800 border-b border-slate-700 p-4">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <div class="flex items-center gap-4">
                <a href="index.html" class="text-slate-400 hover:text-white transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                    </svg>
                </a>
                <h1 id="roomName" class="text-xl font-bold">Oda</h1>
            </div>

            <div class="flex items-center gap-4">
                <div class="flex items-center gap-2 px-3 py-1.5 bg-slate-700 rounded-full">
                    <svg class="w-4 h-4 text-brand-500" fill="currentColor" viewBox="0 0 20 20">
                        <path
                            d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z" />
                    </svg>
                    <span id="userCount">1</span>
                </div>

                <button id="btnInvite"
                    class="flex items-center gap-2 px-4 py-1.5 bg-brand-600 hover:bg-brand-500 rounded-full transition-colors">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
                    </svg>
                    Davet Et
                </button>

                <button id="btnStats"
                    class="flex items-center gap-2 px-3 py-1.5 bg-slate-700 hover:bg-slate-600 rounded-full transition-colors">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 19h16M4 15h7m-7-4h10m-10-4h16" />
                    </svg>
                    Ä°statistik
                </button>
            </div>
        </div>
    </header>

    <div id="statsPanel"
        class="fixed bottom-4 left-4 bg-slate-800/90 border border-slate-700 rounded-xl p-4 text-sm text-slate-200 hidden">
        <div class="font-semibold mb-2">BaÄŸlantÄ± Ä°statistikleri</div>
        <div class="grid grid-cols-2 gap-x-4 gap-y-1">
            <div>Bitrate:</div>
            <div id="statsBitrate">-</div>
            <div>FPS:</div>
            <div id="statsFps">-</div>
            <div>RTT:</div>
            <div id="statsRtt">-</div>
            <div>Packet Loss:</div>
            <div id="statsLoss">-</div>
            <div>Jitter:</div>
            <div id="statsJitter">-</div>
        </div>
    </div>

    <main class="max-w-7xl mx-auto p-4 lg:p-6">
        <div class="grid lg:grid-cols-4 gap-6">

            <!-- Video Container -->
            <div class="lg:col-span-3">
                <div id="videoContainer" class="bg-black rounded-2xl overflow-hidden aspect-video relative">
                    <video id="remoteVideo" autoplay playsinline class="w-full h-full object-contain"></video>
                    <video id="localVideo" autoplay playsinline muted
                        class="hidden w-full h-full object-contain"></video>

                    <div id="pausedOverlay"
                        class="absolute inset-0 bg-black/80 flex flex-col items-center justify-center hidden">
                        <svg class="w-16 h-16 text-slate-500 mb-4" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z" />
                        </svg>
                        <p class="text-slate-400 text-lg">YayÄ±n duraklatÄ±ldÄ±</p>
                        <p class="text-slate-500 text-sm">YayÄ±ncÄ± yayÄ±nÄ± durdurdu</p>
                    </div>

                    <div id="waitingOverlay"
                        class="absolute inset-0 bg-black/80 flex flex-col items-center justify-center">
                        <div
                            class="w-12 h-12 border-4 border-brand-500 border-t-transparent rounded-full animate-spin mb-4">
                        </div>
                        <p class="text-slate-400">YayÄ±n bekleniyor...</p>
                    </div>
                </div>

                <div id="viewerControls" class="mt-4 flex items-center gap-4 hidden">
                    <button id="btnPlayPause" class="p-2 bg-slate-700 rounded-lg hover:bg-slate-600 transition-colors">
                        <svg id="iconPlay" class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M8 5v14l11-7z" />
                        </svg>
                        <svg id="iconPause" class="w-6 h-6 hidden" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z" />
                        </svg>
                    </button>
                    <div class="flex items-center gap-2">
                        <button id="btnMute" class="p-2 bg-slate-700 rounded-lg hover:bg-slate-600 transition-colors">
                            <svg id="iconVolumeOn" class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path
                                    d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z" />
                            </svg>
                            <svg id="iconVolumeOff" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 24 24">
                                <path
                                    d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z" />
                            </svg>
                        </button>
                        <input type="range" id="volumeSlider" min="0" max="1" step="0.1" value="1" class="w-24">
                    </div>
                    <select id="qualitySelect"
                        class="px-3 py-2 bg-slate-700 rounded-lg text-sm border border-slate-600">
                        <option value="auto">Otomatik</option>
                        <option value="high">YÃ¼ksek</option>
                        <option value="mid">Orta</option>
                        <option value="low">DÃ¼ÅŸÃ¼k</option>
                    </select>
                    <button id="btnFullscreen"
                        class="p-2 bg-slate-700 rounded-lg hover:bg-slate-600 transition-colors ml-auto">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z" />
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="lg:col-span-1 space-y-4">

                <!-- Admin Panel -->
                <div id="adminPanel" class="bg-slate-800 rounded-xl p-4 border border-slate-700 hidden">
                    <h3 class="font-semibold mb-4 flex items-center gap-2">
                        <svg class="w-5 h-5 text-brand-500" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd"
                                d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z"
                                clip-rule="evenodd" />
                        </svg>
                        YayÄ±n Kontrolleri
                    </h3>

                    <div class="space-y-3 mb-4">
                        <div>
                            <label class="text-xs text-slate-400">Ã‡Ã¶zÃ¼nÃ¼rlÃ¼k</label>
                            <select id="resSelect" class="w-full mt-1 px-3 py-2 bg-slate-700 rounded-lg text-sm">
                                <option value="1080">1080p</option>
                                <option value="720" selected>720p</option>
                                <option value="480">480p</option>
                                <option value="360">360p</option>
                                <option value="240">240p</option>
                                <option value="144">144p</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-xs text-slate-400">FPS</label>
                            <select id="fpsSelect" class="w-full mt-1 px-3 py-2 bg-slate-700 rounded-lg text-sm">
                                <option value="60">60 FPS</option>
                                <option value="30" selected>30 FPS</option>
                                <option value="24">24 FPS</option>
                                <option value="15">15 FPS</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-xs text-slate-400">Max Bitrate (Kbps)</label>
                            <input id="bitrateInput" type="number" value="2500" step="500"
                                class="w-full mt-1 px-3 py-2 bg-slate-700 rounded-lg text-sm">
                        </div>
                    </div>

                    <div class="space-y-2">
                        <button id="btnStartStream"
                            class="w-full py-2 bg-green-600 hover:bg-green-500 rounded-lg font-semibold transition-colors flex items-center justify-center gap-2">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M8 5v14l11-7z" />
                            </svg>
                            YayÄ±n BaÅŸlat
                        </button>
                        <button id="btnStopStream"
                            class="w-full py-2 bg-red-600 hover:bg-red-500 rounded-lg font-semibold transition-colors hidden flex items-center justify-center gap-2">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M6 6h12v12H6z" />
                            </svg>
                            YayÄ±nÄ± Durdur
                        </button>
                    </div>

                    <div class="mt-4 pt-4 border-t border-slate-700 space-y-2">
                        <button id="btnToggleMic"
                            class="w-full py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm transition-colors">
                            ðŸŽ¤ Mikrofon (KapalÄ±)
                        </button>
                        <button id="btnToggleAudio"
                            class="w-full py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm transition-colors">
                            ðŸ”Š Sistem Sesi (KapalÄ±)
                        </button>
                    </div>

                    <div class="mt-4 pt-4 border-t border-slate-700">
                        <div class="mb-3">
                            <label class="text-xs text-slate-400">Max KullanÄ±cÄ±</label>
                            <input id="maxUsersInput" type="number" value="8" min="2" max="1000"
                                class="w-full mt-1 px-3 py-2 bg-slate-700 rounded-lg text-sm">
                        </div>
                        <button id="btnUpdateMaxUsers"
                            class="w-full py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm transition-colors">
                            Limiti GÃ¼ncelle
                        </button>
                    </div>

                    <div class="mt-4 pt-4 border-t border-slate-700">
                        <button id="btnCloseRoom"
                            class="w-full py-2 bg-red-600/20 hover:bg-red-600/40 text-red-400 rounded-lg text-sm transition-colors">
                            OdayÄ± Kapat
                        </button>
                    </div>
                </div>

                <div id="viewerInfo" class="bg-slate-800 rounded-xl p-4 border border-slate-700 hidden">
                    <p class="text-slate-400 text-center mb-4">YayÄ±nÄ± izliyorsunuz</p>
                    <button id="btnLeaveRoom"
                        class="w-full py-2 bg-red-600/20 hover:bg-red-600/40 text-red-400 rounded-lg text-sm transition-colors">
                        Odadan Ã‡Ä±k
                    </button>
                </div>

            </div>
        </div>
    </main>

    <!-- Leave Confirmation Modal -->
    <div id="leaveModal" class="fixed inset-0 bg-black/70 backdrop-blur-sm hidden items-center justify-center z-50">
        <div class="bg-slate-800 rounded-2xl p-6 w-full max-w-md mx-4 border border-slate-700">
            <h3 class="text-xl font-bold mb-2">Odadan Ã‡Ä±k</h3>
            <p class="text-slate-400 mb-6">Odadan Ã§Ä±kmak istiyor musunuz?</p>
            <div class="flex gap-3">
                <button id="btnCancelLeave"
                    class="flex-1 py-2 rounded-lg border border-slate-600 hover:bg-slate-700 transition-colors">
                    HayÄ±r
                </button>
                <button id="btnConfirmLeave"
                    class="flex-1 py-2 rounded-lg bg-red-600 hover:bg-red-500 font-semibold transition-colors">
                    Evet
                </button>
            </div>
        </div>
    </div>

    <!-- Password Modal -->
    <div id="passwordModal" class="fixed inset-0 bg-black/70 backdrop-blur-sm hidden items-center justify-center z-50">
        <div class="bg-slate-800 rounded-2xl p-6 w-full max-w-md mx-4 border border-slate-700">
            <h3 class="text-xl font-bold mb-2">Åžifre Gerekli</h3>
            <p class="text-slate-400 mb-4">Bu oda ÅŸifre ile korunuyor</p>
            <div class="space-y-4">
                <input id="passwordInput" type="password" placeholder="Oda ÅŸifresi"
                    class="w-full px-4 py-2 bg-slate-700 rounded-lg border border-slate-600 focus:border-brand-500 focus:outline-none">
                <p id="passwordModalError" class="text-red-400 text-sm hidden"></p>
            </div>
            <div class="flex gap-3 mt-6">
                <button id="btnCancelPassword"
                    class="flex-1 py-2 rounded-lg border border-slate-600 hover:bg-slate-700 transition-colors">
                    Geri
                </button>
                <button id="btnSubmitPassword"
                    class="flex-1 py-2 rounded-lg bg-brand-600 hover:bg-brand-500 font-semibold transition-colors">
                    KatÄ±l
                </button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast"
        class="fixed bottom-4 right-4 bg-slate-800 border border-slate-700 text-white px-6 py-3 rounded-lg shadow-lg hidden">
        <p id="toastMessage"></p>
    </div>

    <script type="module" src="room.js"></script>
</body>

</html>