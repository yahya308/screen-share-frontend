<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Mobil Test Sayfasƒ± - Samsung Optimizasyonu</title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            padding: 20px;
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin: 0 0 20px 0;
            font-size: 1.8rem;
            font-weight: 700;
        }
        
        .test-section {
            background: linear-gradient(135deg, #e7f3ff, #d1ecf1);
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border-left: 4px solid #007bff;
        }
        
        .test-section h3 {
            margin: 0 0 15px 0;
            color: #004085;
        }
        
        .test-button {
            background: linear-gradient(135deg, #28a745, #218838);
            color: white;
            border: none;
            padding: 15px 25px;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 10px;
            cursor: pointer;
            margin: 10px 5px;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(40,167,69,0.3);
            min-width: 150px;
            touch-action: manipulation;
        }
        
        .test-button:hover {
            background: linear-gradient(135deg, #218838, #1e7e34);
            transform: translateY(-2px);
        }
        
        .test-button:disabled {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            cursor: not-allowed;
            transform: none;
        }
        
        .result {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 3px solid #6c757d;
            font-family: monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .success {
            border-left-color: #28a745;
            background: #d4edda;
            color: #155724;
        }
        
        .error {
            border-left-color: #dc3545;
            background: #f8d7da;
            color: #721c24;
        }
        
        .warning {
            border-left-color: #ffc107;
            background: #fff3cd;
            color: #856404;
        }
        
        .device-info {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #ffc107;
        }
        
        .samsung-optimization {
            background: linear-gradient(135deg, #e8f5e8, #d4edda);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #28a745;
        }
        
        .video-test {
            background: #000;
            width: 100%;
            max-width: 400px;
            height: 300px;
            margin: 20px auto;
            display: block;
            border-radius: 10px;
            border: 3px solid #ddd;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            .test-button {
                width: 100%;
                margin: 5px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Mobil Test Sayfasƒ±</h1>
        
        <div class="device-info">
            <h3>üì± Cihaz Bilgileri</h3>
            <div id="deviceInfo">Y√ºkleniyor...</div>
        </div>
        
        <div class="samsung-optimization">
            <h3>üì± Samsung Optimizasyonlarƒ±</h3>
            <div id="samsungInfo">Kontrol ediliyor...</div>
        </div>
        
        <div class="test-section">
            <h3>üé• Video Test</h3>
            <p>Video element'inin mobil cihazlarda d√ºzg√ºn √ßalƒ±≈üƒ±p √ßalƒ±≈ümadƒ±ƒüƒ±nƒ± test edin.</p>
            <button class="test-button" onclick="testVideoElement()">Video Element Testi</button>
            <button class="test-button" onclick="testWebRTC()">WebRTC Testi</button>
            <button class="test-button" onclick="testTouchEvents()">Touch Event Testi</button>
            <button class="test-button" onclick="testCodecSupport()">Codec Desteƒüi Testi</button>
            
            <video id="testVideo" class="video-test" autoplay muted playsinline></video>
            
            <div id="videoResults" class="result" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h3>üîß Performans Testleri</h3>
            <p>Mobil cihaz performansƒ±nƒ± ve optimizasyonlarƒ± test edin.</p>
            <button class="test-button" onclick="testHardwareAcceleration()">Hardware Acceleration</button>
            <button class="test-button" onclick="testMemoryUsage()">Memory Usage</button>
            <button class="test-button" onclick="testNetworkLatency()">Network Latency</button>
            
            <div id="performanceResults" class="result" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h3>üìä Test Sonu√ßlarƒ±</h3>
            <div id="allResults" class="result"></div>
        </div>
    </div>

    <script>
        let testResults = [];
        
        // Device detection
        function detectDevice() {
            const userAgent = navigator.userAgent;
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent);
            const isSamsung = /Samsung|SM-/.test(userAgent);
            const isIOS = /iPad|iPhone|iPod/.test(userAgent);
            
            let browser = 'Unknown';
            if (userAgent.includes('Chrome') && !userAgent.includes('Edg')) browser = 'Chrome';
            else if (userAgent.includes('Firefox')) browser = 'Firefox';
            else if (userAgent.includes('Safari') && !userAgent.includes('Chrome')) browser = 'Safari';
            else if (userAgent.includes('Edg')) browser = 'Edge';
            else if (userAgent.includes('SamsungBrowser')) browser = 'Samsung Internet';
            
            const deviceInfo = {
                isMobile,
                isSamsung,
                isIOS,
                browser,
                userAgent: userAgent.substring(0, 100) + '...',
                screenResolution: `${screen.width}x${screen.height}`,
                viewport: `${window.innerWidth}x${window.innerHeight}`,
                pixelRatio: window.devicePixelRatio,
                orientation: window.orientation || 'unknown'
            };
            
            document.getElementById('deviceInfo').innerHTML = `
                <strong>Mobil:</strong> ${isMobile ? '‚úÖ Evet' : '‚ùå Hayƒ±r'}<br>
                <strong>Samsung:</strong> ${isSamsung ? '‚úÖ Evet' : '‚ùå Hayƒ±r'}<br>
                <strong>iOS:</strong> ${isIOS ? '‚úÖ Evet' : '‚ùå Hayƒ±r'}<br>
                <strong>Tarayƒ±cƒ±:</strong> ${browser}<br>
                <strong>Ekran:</strong> ${deviceInfo.screenResolution}<br>
                <strong>Viewport:</strong> ${deviceInfo.viewport}<br>
                <strong>Pixel Ratio:</strong> ${deviceInfo.pixelRatio}<br>
                <strong>Oryantasyon:</strong> ${deviceInfo.orientation}
            `;
            
            return deviceInfo;
        }
        
        // Samsung optimizations check
        function checkSamsungOptimizations() {
            const deviceInfo = detectDevice();
            let optimizations = [];
            
            if (deviceInfo.isSamsung) {
                optimizations.push('‚úÖ Samsung cihaz tespit edildi');
                optimizations.push('‚úÖ Samsung Internet optimizasyonlarƒ± aktif');
                
                // Check for Samsung-specific features
                if (navigator.mediaDevices && navigator.mediaDevices.getDisplayMedia) {
                    optimizations.push('‚úÖ Ekran payla≈üƒ±mƒ± destekleniyor');
                } else {
                    optimizations.push('‚ùå Ekran payla≈üƒ±mƒ± desteklenmiyor');
                }
                
                // Check for hardware acceleration
                const canvas = document.createElement('canvas');
                const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                if (gl) {
                    const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
                    if (debugInfo) {
                        const renderer = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);
                        optimizations.push(`‚úÖ Hardware acceleration: ${renderer}`);
                    }
                }
                
            } else {
                optimizations.push('‚ùå Samsung cihaz deƒüil');
            }
            
            document.getElementById('samsungInfo').innerHTML = optimizations.join('<br>');
        }
        
        // Test video element
        async function testVideoElement() {
            const results = [];
            results.push('=== Video Element Testi ===');
            
            try {
                const video = document.getElementById('testVideo');
                
                // Test video attributes
                video.setAttribute('webkit-playsinline', 'true');
                video.setAttribute('playsinline', 'true');
                video.setAttribute('muted', 'true');
                video.muted = true;
                video.autoplay = true;
                
                results.push('‚úÖ Video attributes set');
                
                // Test hardware acceleration
                video.style.transform = 'translateZ(0)';
                video.style.webkitTransform = 'translateZ(0)';
                video.style.willChange = 'transform';
                video.style.backfaceVisibility = 'hidden';
                
                results.push('‚úÖ Hardware acceleration styles applied');
                
                // Test video capabilities
                if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                    try {
                        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                        video.srcObject = stream;
                        results.push('‚úÖ Camera stream connected');
                        
                        // Test play
                        try {
                            await video.play();
                            results.push('‚úÖ Video play successful');
                        } catch (playError) {
                            results.push(`‚ö†Ô∏è Video play failed: ${playError.message}`);
                        }
                        
                        // Stop stream after test
                        stream.getTracks().forEach(track => track.stop());
                        
                    } catch (cameraError) {
                        results.push(`‚ùå Camera access failed: ${cameraError.message}`);
                    }
                } else {
                    results.push('‚ùå getUserMedia not supported');
                }
                
            } catch (error) {
                results.push(`‚ùå Video test error: ${error.message}`);
            }
            
            showResults('videoResults', results.join('\n'), 'success');
            addToAllResults(results.join('\n'));
        }
        
        // Test WebRTC
        async function testWebRTC() {
            const results = [];
            results.push('=== WebRTC Testi ===');
            
            try {
                // Test RTCPeerConnection
                if (window.RTCPeerConnection) {
                    results.push('‚úÖ RTCPeerConnection supported');
                    
                    const pc = new RTCPeerConnection({
                        iceServers: [{ urls: 'stun:stun.l.google.com:19302' }]
                    });
                    
                    results.push('‚úÖ RTCPeerConnection created');
                    
                    // Test offer creation
                    try {
                        const offer = await pc.createOffer();
                        results.push('‚úÖ Offer created successfully');
                        results.push(`   SDP length: ${offer.sdp.length}`);
                        
                        // Check for H.264 support
                        if (offer.sdp.includes('H264')) {
                            results.push('‚úÖ H.264 codec supported');
                        } else {
                            results.push('‚ùå H.264 codec not found');
                        }
                        
                    } catch (offerError) {
                        results.push(`‚ùå Offer creation failed: ${offerError.message}`);
                    }
                    
                    pc.close();
                    results.push('‚úÖ RTCPeerConnection closed');
                    
                } else {
                    results.push('‚ùå RTCPeerConnection not supported');
                }
                
                // Test media devices
                if (navigator.mediaDevices) {
                    results.push('‚úÖ MediaDevices API supported');
                    
                    if (navigator.mediaDevices.getDisplayMedia) {
                        results.push('‚úÖ getDisplayMedia supported');
                    } else {
                        results.push('‚ùå getDisplayMedia not supported');
                    }
                    
                } else {
                    results.push('‚ùå MediaDevices API not supported');
                }
                
            } catch (error) {
                results.push(`‚ùå WebRTC test error: ${error.message}`);
            }
            
            showResults('performanceResults', results.join('\n'), 'success');
            addToAllResults(results.join('\n'));
        }
        
        // Test touch events
        function testTouchEvents() {
            const results = [];
            results.push('=== Touch Event Testi ===');
            
            try {
                const video = document.getElementById('testVideo');
                
                // Test touch event support
                if ('ontouchstart' in window) {
                    results.push('‚úÖ Touch events supported');
                    
                    // Test Samsung-specific touch handling
                    const isSamsung = /Samsung|SM-/.test(navigator.userAgent);
                    if (isSamsung) {
                        results.push('‚úÖ Samsung device detected');
                        
                        // Apply Samsung touch optimizations
                        video.style.touchAction = 'manipulation';
                        video.style.webkitTouchCallout = 'none';
                        video.style.webkitUserSelect = 'none';
                        video.style.userSelect = 'none';
                        
                        results.push('‚úÖ Samsung touch optimizations applied');
                    }
                    
                } else {
                    results.push('‚ùå Touch events not supported');
                }
                
                // Test gesture events (Samsung specific)
                if ('ongesturestart' in window) {
                    results.push('‚úÖ Gesture events supported (Samsung)');
                } else {
                    results.push('‚ö†Ô∏è Gesture events not supported');
                }
                
            } catch (error) {
                results.push(`‚ùå Touch test error: ${error.message}`);
            }
            
            showResults('performanceResults', results.join('\n'), 'success');
            addToAllResults(results.join('\n'));
        }
        
        // Test codec support
        function testCodecSupport() {
            const results = [];
            results.push('=== Codec Desteƒüi Testi ===');
            
            try {
                const video = document.getElementById('testVideo');
                
                // Test video codec support
                if (video.canPlayType) {
                    const h264 = video.canPlayType('video/mp4; codecs="avc1.42E01E"');
                    const h265 = video.canPlayType('video/mp4; codecs="hev1.1.6.L93.B0"');
                    const vp9 = video.canPlayType('video/webm; codecs="vp9"');
                    
                    results.push(`H.264: ${h264 || '‚ùå'}`);
                    results.push(`H.265: ${h265 || '‚ùå'}`);
                    results.push(`VP9: ${vp9 || '‚ùå'}`);
                    
                    if (h264) {
                        results.push('‚úÖ H.264 codec supported (recommended for mobile)');
                    } else {
                        results.push('‚ùå H.264 codec not supported (may cause issues)');
                    }
                } else {
                    results.push('‚ùå canPlayType not supported');
                }
                
                // Test audio codec support
                if (video.canPlayType) {
                    const aac = video.canPlayType('audio/mp4; codecs="mp4a.40.2"');
                    const opus = video.canPlayType('audio/webm; codecs="opus"');
                    
                    results.push(`AAC: ${aac || '‚ùå'}`);
                    results.push(`Opus: ${opus || '‚ùå'}`);
                }
                
            } catch (error) {
                results.push(`‚ùå Codec test error: ${error.message}`);
            }
            
            showResults('performanceResults', results.join('\n'), 'success');
            addToAllResults(results.join('\n'));
        }
        
        // Test hardware acceleration
        function testHardwareAcceleration() {
            const results = [];
            results.push('=== Hardware Acceleration Testi ===');
            
            try {
                // Test WebGL
                const canvas = document.createElement('canvas');
                const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                
                if (gl) {
                    results.push('‚úÖ WebGL supported');
                    
                    const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
                    if (debugInfo) {
                        const renderer = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);
                        const vendor = gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL);
                        
                        results.push(`   Renderer: ${renderer}`);
                        results.push(`   Vendor: ${vendor}`);
                        
                        if (renderer.includes('GPU') || renderer.includes('Graphics')) {
                            results.push('‚úÖ Dedicated GPU detected');
                        } else {
                            results.push('‚ö†Ô∏è Integrated graphics detected');
                        }
                    }
                } else {
                    results.push('‚ùå WebGL not supported');
                }
                
                // Test CSS transforms
                const testDiv = document.createElement('div');
                testDiv.style.transform = 'translateZ(0)';
                testDiv.style.webkitTransform = 'translateZ(0)';
                
                if (testDiv.style.transform || testDiv.style.webkitTransform) {
                    results.push('‚úÖ CSS 3D transforms supported');
                } else {
                    results.push('‚ùå CSS 3D transforms not supported');
                }
                
            } catch (error) {
                results.push(`‚ùå Hardware acceleration test error: ${error.message}`);
            }
            
            showResults('performanceResults', results.join('\n'), 'success');
            addToAllResults(results.join('\n'));
        }
        
        // Test memory usage
        function testMemoryUsage() {
            const results = [];
            results.push('=== Memory Usage Testi ===');
            
            try {
                // Test memory info if available
                if (performance.memory) {
                    const memory = performance.memory;
                    results.push(`Total JS Heap Size: ${Math.round(memory.totalJSHeapSize / 1048576)} MB`);
                    results.push(`Used JS Heap Size: ${Math.round(memory.usedJSHeapSize / 1048576)} MB`);
                    results.push(`JS Heap Size Limit: ${Math.round(memory.jsHeapSizeLimit / 1048576)} MB`);
                    
                    const usagePercent = (memory.usedJSHeapSize / memory.totalJSHeapSize * 100).toFixed(1);
                    results.push(`Memory Usage: ${usagePercent}%`);
                    
                    if (usagePercent > 80) {
                        results.push('‚ö†Ô∏è High memory usage detected');
                    } else {
                        results.push('‚úÖ Memory usage normal');
                    }
                } else {
                    results.push('‚ö†Ô∏è Memory info not available');
                }
                
                // Test device memory if available
                if (navigator.deviceMemory) {
                    results.push(`Device Memory: ${navigator.deviceMemory} GB`);
                    
                    if (navigator.deviceMemory < 2) {
                        results.push('‚ö†Ô∏è Low device memory - may affect performance');
                    } else {
                        results.push('‚úÖ Sufficient device memory');
                    }
                } else {
                    results.push('‚ö†Ô∏è Device memory info not available');
                }
                
            } catch (error) {
                results.push(`‚ùå Memory test error: ${error.message}`);
            }
            
            showResults('performanceResults', results.join('\n'), 'success');
            addToAllResults(results.join('\n'));
        }
        
        // Test network latency
        function testNetworkLatency() {
            const results = [];
            results.push('=== Network Latency Testi ===');
            
            try {
                // Test connection info
                if (navigator.connection) {
                    const connection = navigator.connection;
                    results.push(`Connection Type: ${connection.effectiveType || 'unknown'}`);
                    results.push(`Downlink: ${connection.downlink || 'unknown'} Mbps`);
                    results.push(`RTT: ${connection.rtt || 'unknown'} ms`);
                    
                    if (connection.effectiveType === '4g' || connection.effectiveType === '5g') {
                        results.push('‚úÖ Good connection for video streaming');
                    } else if (connection.effectiveType === '3g') {
                        results.push('‚ö†Ô∏è Moderate connection - may affect quality');
                    } else {
                        results.push('‚ùå Poor connection - may cause issues');
                    }
                } else {
                    results.push('‚ö†Ô∏è Connection info not available');
                }
                
                // Test ping to server
                const startTime = performance.now();
                fetch('/health')
                    .then(response => response.json())
                    .then(data => {
                        const endTime = performance.now();
                        const latency = Math.round(endTime - startTime);
                        results.push(`Server Latency: ${latency} ms`);
                        
                        if (latency < 100) {
                            results.push('‚úÖ Excellent latency');
                        } else if (latency < 300) {
                            results.push('‚úÖ Good latency');
                        } else {
                            results.push('‚ö†Ô∏è High latency - may affect performance');
                        }
                        
                        showResults('performanceResults', results.join('\n'), 'success');
                        addToAllResults(results.join('\n'));
                    })
                    .catch(error => {
                        results.push(`‚ùå Latency test failed: ${error.message}`);
                        showResults('performanceResults', results.join('\n'), 'error');
                        addToAllResults(results.join('\n'));
                    });
                
                return; // Don't show results yet, wait for fetch
                
            } catch (error) {
                results.push(`‚ùå Network test error: ${error.message}`);
            }
            
            showResults('performanceResults', results.join('\n'), 'success');
            addToAllResults(results.join('\n'));
        }
        
        // Helper functions
        function showResults(elementId, content, type) {
            const element = document.getElementById(elementId);
            element.textContent = content;
            element.style.display = 'block';
            element.className = `result ${type}`;
        }
        
        function addToAllResults(content) {
            testResults.push(content);
            document.getElementById('allResults').textContent = testResults.join('\n\n');
        }
        
        // Initialize tests
        document.addEventListener('DOMContentLoaded', () => {
            detectDevice();
            checkSamsungOptimizations();
            
            // Add orientation change handler
            window.addEventListener('orientationchange', () => {
                setTimeout(() => {
                    detectDevice();
                }, 100);
            });
        });
    </script>
</body>
</html>
